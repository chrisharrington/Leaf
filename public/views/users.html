<div class="users-container">
	<loader ng-show="loading"></loader>
	<section class="users-content" ng-hide="loading">
		<div class="page-actions" authorized="create-user">
			<button class="round create-user-trigger" tooltip="Create User" tooltip-alignment="left">
				<i class="fa fa-plus"></i>
			</button>
		</div>

	<div class="users-container">
			<div ng-repeat="user in users | filter: { isDeleted: false }" class="tile">
				<profile-image id="user.id"></profile-image>
				<span class="name">[[user.name]]</span>
				<a class="email" href="mailto:[[user.emailAddress]]" target="_blank">[[user.emailAddress]]</a>
				<div class="counts">
					<div tooltip="Developer Issue Count">
						<i class="fa fa-code"></i>
						<span>[[user.developerIssueCount]]</span>
					</div>
					<div tooltip="Tester Issue Count">
						<i class="fa fa-flask"></i>
						<span>[[user.testerIssueCount]]</span>
					</div>
				</div>
				<div class="actions">
					<i class="fa fa-lock" title="Reset Password" tooltip="Reset Password" tooltip-alignment="right" authorized="reset-password" ng-click="resetPassword.load(user)"></i>
					<i class="fa fa-trash-o" title="Delete User" tooltip="Delete User" authorized="delete-user" ng-click="deleteUser.load(user)"></i>
					<i class="fa fa-pencil" title="Edit User" tooltip="Edit User" authorized="edit-user" ng-click="editUser.load(user)"></i>
					<i class="fa fa-key" title="User Permissions" tooltip="Change Permissions" authorized="modify-user-permissions" ng-click="userPermissions.load(user)"></i>
				</div>
			</div>
		</div>

		<div class="users-container deleted">
			<div class="tile" ng-repeat="user in users | filter: { isDeleted: true }" ng-click="restoreUser.load(user)">
				<profile-image id="user.id"></profile-image>
				<span class="name">[[user.name]]</span>
				<a class="email" href="mailto:[[user.emailAddress]]" target="_blank">[[user.emailAddress]]</a>
				<div class="counts">
					<div tooltip="Developer Issue Count">
						<i class="fa fa-code"></i>
						<span>[[user.developerIssueCount]]</span>
					</div>
					<div tooltip="Tester Issue Count">
						<i class="fa fa-flask"></i>
						<span>[[user.testerIssueCount]]</span>
					</div>
				</div>
			</div>
			<!-- /ko -->
		</div>
	</section>

	<modal class="confirm-reset-password" show="resetPassword.show" title="Reset Password" ok="resetPassword.ok" cancel="resetPassword.cancel" loading="resetPassword.loading">
		<span>Are you sure you want to reset <b>[[resetPassword.user.name]]</b>'s password? An email will be sent to the user with instructions on how to reset their password.</span>
	</modal>

	<modal class="confirm-delete" title="Delete User?" show="deleteUser.show" ok="deleteUser.ok" cancel="deleteUser.cancel" loading="deleteUser.loading">
		<span>Once deleted, <b>[[deleteUser.user.name]]</b> will still be assigned to any issues he or she is currently assigned to, but won't be assignable to any new or existing issues. Are you sure you want to continue?</span>
	</modal>

	<modal class="confirm-undelete" title="Restore User?" show="restoreUser.show" ok="restoreUser.ok" cancel="restoreUser.cancel" loading="restoreUser.loading">
		<span>Once restored, <b>[[user.name]]</b> will be able to be assigned to new issues. Are you sure you want to continue?</span>
	</modal>

	<modal class="edit-user" title="Edit User" show="editUser.show" ok="editUser.ok" cancel="editUser.cancel" loading="editUser.loading">
		<div class="form">
			<text type="text" placeholder="Name..." ng-model="editUser.user.name"></text>
			<text type="text" placeholder="Email address..." ng-model="editUser.user.emailAddress"></text>
		</div>
	</modal>

	<modal class="user-permissions" title="User Permissions" show="userPermissions.show" ok="userPermissions.ok" cancel="userPermissions.cancel" loading="userPermissions.loading">
		<span>Toggle permissions for <b>[[userPermissions.user.name]]</b> by clicking the entries below. Note that some permissions are read-only, even for administrators. This is to prevent administrators from removing key permissions from users, such as the ability to remove the ability to set permissions...</span>
		<div class="permissions">
			<div ng-repeat="permission in $root.permissions">
				<checkbox ng-if="permission.tag !== 'modify-user-permissions'" checked="userPermissions.permissions[permission.id]">[[permission.name]]</checkbox>
				<checkbox ng-if="permission.tag === 'modify-user-permissions'" readonly checked="userPermissions.permissions[permission.id]">[[permission.name]]</checkbox>
			</div>
		</div>
	</modal>

	<script type="text/html" id="create-user-template">
		<div class="create-user form">
			<h1>Create User</h1>
			<span>Once created, the new user will receive an email with instructions on how to activate his or her account.</span>
			<input type="text" placeholder="Name..." data-bind="value: user().name" />
			<input type="text" placeholder="Email address..." data-bind="value: user().emailAddress" />
			<div class="button-container">
				<button class="round" data-bind="click: cancel">
					<i class="fa fa-times"></i>
				</button>
				<button class="round" data-bind="click: save, css: { loading: loading }">
					<i class="fa fa-check"></i>
				</button>
			</div>
		</div>
	</script>

	<script type="text/html" id="user-permissions">
		<div class="user-permissions form">
			<h1>User Permissions</h1>
			<span>Toggle permissions for <b data-bind="text: name"></b> by clicking the entries below. Note that some permissions are read-only, even for administrators; this is to prevent administrators from removing key permissions from users, such as the ability to remove the ability to set permissions...</span>
			<div class="permissions" data-bind="foreach: IssueTracker.permissions">
				<div data-bind="click: $root.togglePermission">
					<i class="fa fa-square" data-bind="visible: !$root.userPermissions()[$data.id()]()"></i>
					<i class="fa fa-check-square" data-bind="visible: $root.userPermissions()[$data.id()]"></i>
					<span data-bind="text: name"></span>
				</div>
			</div>
			<div class="button-container">
				<button class="round" data-bind="click: cancel">
					<i class="fa fa-times"></i>
				</button>
				<button class="round" data-bind="click: save, css: { loading: loading }">
					<i class="fa fa-check"></i>
				</button>
			</div>
		</div>
	</script>
</div>